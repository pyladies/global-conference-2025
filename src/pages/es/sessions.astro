---
import Container from "@components/container.astro";
import Sectionhead from "@components/sectionhead.astro";
import Layout from "@layouts/Layout.astro";
import Filter from "@components/sessions/filter.astro";
import ListSessions from "@components/sessions/list-sessions.astro";

import { getLangFromUrl, useTranslations } from "../../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

let sessionsData: Record<string, any> = {};
let speakersData: Record<string, any> = {};

try {
  // @ts-ignore
  const sessionsModule = await import("../../data/sessions.json");
  sessionsData = sessionsModule.default || sessionsModule;
  
  // @ts-ignore
  const speakersModule = await import("../../data/speakers.json");
  speakersData = speakersModule.default || speakersModule;
} catch (e) {}

const sessions = Object.entries(sessionsData).sort((a, b) => {
  const titleA = a[1].title?.toLowerCase() || '';
  const titleB = b[1].title?.toLowerCase() || '';
  return titleA.localeCompare(titleB);
});

const allTracks = Array.from(
  new Set(
    sessions
      .map(([_, session]) => session.track)
      .filter((track) => track)
  )
).sort();

const allTypes = Array.from(
  new Set(
    sessions
      .map(([_, session]) => session.session_type)
      .filter((type) => type)
  )
).sort();

const allLevels = Array.from(
  new Set(
    sessions
      .map(([_, session]) => session.level)
      .filter((level) => level)
  )
).sort();

const allLanguages = Array.from(
  new Set(
    sessions
      .map(([_, session]) => session.language)
      .filter((language) => language)
  )
).sort();
---

<Layout title={t('sessions.title')} lang="es">
  <Container>
    <Sectionhead>
      <Fragment slot="title">{t('sessions.list_title')}</Fragment>
      <Fragment slot="subtitle"></Fragment>
      <Fragment slot="description">
        {t('sessions.description')}
      </Fragment>
    </Sectionhead>

    <div class="mt-12">
      <h2 class="text-2xl font-bold mb-6 text-black dark:text-white">{t('sessions.filters_title')}</h2>
      
      <Filter allTracks={allTracks} allTypes={allTypes} allLevels={allLevels} allLanguages={allLanguages} lang={lang} />

      <h2 class="text-2xl font-bold mb-6 mt-12 text-black dark:text-white">{t('sessions.results_title')}</h2>

      {sessions.length === 0 ? (
        <div class="text-center py-12">
          <p class="text-lg text-black dark:text-white">{t('sessions.no_sessions')}</p>
        </div>
      ) : (
        <ListSessions sessions={sessions} lang={lang} speakersData={speakersData} />
      )}
    </div>
  </Container>
</Layout>
