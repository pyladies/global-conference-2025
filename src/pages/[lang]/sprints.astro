---
import { getLocaleStaticPaths } from "../../i18n/locales";
export const getStaticPaths = getLocaleStaticPaths;

import Container from "@components/container.astro";
import Sectionhead from "@components/sectionhead.astro";
import Layout from "@layouts/Layout.astro";
import { useTranslations } from '../../i18n/utils';
import { getCollection } from 'astro:content';

const { lang } = Astro.params;
const t = useTranslations(lang as any);

const { align = "center" } = Astro.props;

// get sprints for the current locale, fallback to English if no sprints found
let allSprints = await getCollection('sprints', ({ id }) => {
  return id.startsWith(`${lang}/`);
});

if (allSprints.length === 0) {
  console.warn(`No sprints found for language: ${lang}, falling back to English`);
  allSprints = await getCollection('sprints', ({ id }) => {
    return id.startsWith('en/');
  });
}

const sprintsData = await Promise.all(
  allSprints.map(async (sprint) => {
    const { Content } = await sprint.render();
    return {
      ...sprint.data,
      description: Content,
    };
  })
);
---

<Layout title="Sponsors" lang={lang}>
  <Container>
    <Sectionhead>
      <Fragment slot="subtitle">{t("header.sprints_subtitle")}</Fragment>
      <Fragment slot="title">{t("sprints.title")}</Fragment>
      <Fragment slot="description">
      {t("sprints.description")}
      </Fragment>
    </Sectionhead>

    <div class="grid md:grid-cols-1 gap-10 mx-auto max-w-5xl mt-10">
        {sprintsData.length === 0 && <div class="text-center dark:text-white"><h3>{t("sprints.empty")}</h3></div>}
      {sprintsData.map((sprint) => {
        const Description = sprint.description;
        return (
      <div class="rounded-md p-5 xl:p-8 ring-1 ring-gray-200 dark:bg-stone-950 dark:ring-gray-700">
        <a class="flex items-center" href={sprint.project_url}>
          <h3 class="text-md font-semibold leading-8 text-pinkpyladies mr-2">{sprint.name}</h3>
          <svg
             class="size-3 text-pinkpyladies"
             viewBox="0 0 16.284918 16.024687"
             version="1.1"
             stroke="currentColor"
             id="svg1"
             inkscape:version="1.4.2 (ebf0e940d0, 2025-05-08)"
             sodipodi:docname="url.svg"
             xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
             xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
             xmlns="http://www.w3.org/2000/svg"
             xmlns:svg="http://www.w3.org/2000/svg">
            <sodipodi:namedview
               id="namedview1"
               pagecolor="#505050"
               bordercolor="#eeeeee"
               borderopacity="1"
               inkscape:showpageshadow="0"
               inkscape:pageopacity="0"
               inkscape:pagecheckerboard="0"
               inkscape:deskcolor="#d1d1d1"
               inkscape:document-units="mm"
               inkscape:zoom="6.2430976"
               inkscape:cx="13.615036"
               inkscape:cy="41.645993"
               inkscape:window-width="1920"
               inkscape:window-height="1080"
               inkscape:window-x="0"
               inkscape:window-y="0"
               inkscape:window-maximized="1"
               inkscape:current-layer="layer1" />
            <defs
               id="defs1">
              <marker
                 style="overflow:visible"
                 id="ArrowWideHeavy"
                 refX="0"
                 refY="0"
                 orient="auto-start-reverse"
                 inkscape:stockid="Wide, heavy arrow"
                 markerWidth="1"
                 markerHeight="1"
                 viewBox="0 0 1 1"
                 inkscape:isstock="true"
                 inkscape:collect="always"
                 preserveAspectRatio="xMidYMid">
                <path
                   style="fill:context-stroke;fill-rule:evenodd;stroke:none"
                   d="m 1,0 -3,3 h -2 l 3,-3 -3,-3 h 2 z"
                   id="path3" />
              </marker>
            </defs>
            <g
               inkscape:label="Layer 1"
               inkscape:groupmode="layer"
               id="layer1"
               transform="translate(-80.1806,-98.850984)">
              <path
                 style="fill:none;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-end:url(#ArrowWideHeavy)"
                 d="M 84.836314,110.34535 95.311786,99.972611"
                 id="path1"
                 sodipodi:nodetypes="cc" />
              <path
                 style="fill:none;;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1"
                 d="M 86.545509,99.850984 H 81.1806 v 14.024686 h 14.284917 v -4.23639"
                 id="path2"
                 sodipodi:nodetypes="ccccc" />
            </g>
          </svg>
        </a>
        <p class="dark:text-white"><b>{t("sprints.level")}</b> {sprint.level}</p>
        <p class="dark:text-white"><b>{t("sprints.languages")}</b> {sprint.languages}</p>
        <div class="py-5 dark:text-white prose dark:prose-invert">
          <Description />
        </div>
      </div>
        );
      })}
    </div>
  </Container>
</Layout>
